<!DOCTYPE html>
<html>
  <head>
    <title>Fundamental of Data Science for EESS</title>
    <meta charset="utf-8">
    <meta name="author" content="Daniel Vaulot" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis-fonts.css" rel="stylesheet" />
    <script src="libs/kePrint/kePrint.js"></script>
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <link href="libs/leaflet/leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet/leaflet.js"></script>
    <link href="libs/leafletfix/leafletfix.css" rel="stylesheet" />
    <script src="libs/Proj4Leaflet/proj4-compressed.js"></script>
    <script src="libs/Proj4Leaflet/proj4leaflet.js"></script>
    <link href="libs/rstudio_leaflet/rstudio_leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-binding/leaflet.js"></script>
    <link href="libs/leaflet-markercluster/MarkerCluster.css" rel="stylesheet" />
    <link href="libs/leaflet-markercluster/MarkerCluster.Default.css" rel="stylesheet" />
    <script src="libs/leaflet-markercluster/leaflet.markercluster.js"></script>
    <script src="libs/leaflet-markercluster/leaflet.markercluster.freezable.js"></script>
    <script src="libs/leaflet-markercluster/leaflet.markercluster.layersupport.js"></script>
    <script src="libs/leaflet-providers/leaflet-providers.js"></script>
    <script src="libs/leaflet-providers-plugin/leaflet-providers-plugin.js"></script>
    <link rel="stylesheet" href="metropolis-dv.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">






layout: true
background-image: url(img/course-logo.png)
background-position: right top 30px 
background-size: 45%

# Fundamental of Data Science for EESS




---

&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

## R session 05 - Mapping

.font120[**Daniel Vaulot**]

2019-03-15

&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
.pull-left[
&lt;img src="img/NTU-Logo-full-colour.png" width="50%" style="display: block; margin: auto auto auto 0;" /&gt;
]

.pull-right[
&lt;img src="img/logo_SBR.png" width="50%" style="display: block; margin: auto 0 auto auto;" /&gt;
]

---
exclude: true

## Resources used
* Simple maps : https://www.r-spatial.org/r/2018/10/25/ggplot2-sf.html

## Other resources
* Global maps : https://github.com/e-cavan/spatial_mapping_R
* Ocean maps: https://www.researchgate.net/profile/Robert_Bauer9/publication/315494507_oceanmap_Mapping_oceanographic_data/links/58d2987292851cd76d346f65/oceanmap-Mapping-oceanographic-data.pdf


---

class: middle

## Outline


.font150[
* Simple features
* Static maps
* Plotting your data
* Interactive maps
]

---

layout: false

# Installation and Resources

.pull-left[

## Packages

### New
* sf
* rnaturalearth
* rnaturalearthdata
* leaflet

### Previously used
* ggplot2
* stringr
* dplyr



]

.pull-right[

&lt;img src="img/R-geocomputation.png" width="30%" style="display: block; margin: auto;" /&gt;

#### Reading list
* [Geocomputation with R - Chapter 2](https://geocompr.robinlovelace.net/spatial-class.html)
* [Geocomputation with R - Chapter 8](https://geocompr.robinlovelace.net/adv-map.html)

#### Other resources
* [Spatial data science](https://keen-swartz-3146c4.netlify.com/index.html)


]

---

# What we want to do...

&lt;img src="img/map-example-swiss.png" width="70%" style="display: block; margin: auto;" /&gt;

---
layout: true

# Simple Features (sf)

---

&lt;img src="img/sf.jpg" width="60%" style="display: block; margin: auto;" /&gt;

* https://github.com/r-spatial/sf

---

* Simple features is an open standard developed and endorsed by the Open Geospatial Consortium (OGC). 
* Simple Features is a hierarchical data model that represents a wide range of geometry types. 

&lt;img src="img/sf-classes.png" width="40%" style="display: block; margin: auto;" /&gt;

---

* A **point** is simply a coordinate in 2D (can be also 3D or 4D space)
    * POINT (5 2)

* A **linestring** is a sequence of points with a straight line connecting the points
    * LINESTRING (1 5, 4 4, 4 1, 2 2, 3 2)

* A **polygon** is a sequence of points that form a closed, non-intersecting ring. 
    * POLYGON (1 5, 2 2, 4 1, 4 4, 1 5)

&lt;img src="img/sf-classes-01.png" width="60%" style="display: block; margin: auto;" /&gt;

---

  * MULTIPOINT (5 2, 1 3, 3 4, 3 2)
  * MULTILINESTRING ((1 5, 4 4, 4 1, 2 2, 3 2), (1 2, 2 4))
  * MULTIPOLYGON (((1 5, 2 2, 4 1, 4 4, 1 5), (0 2, 1 2, 1 3, 0 3, 0 2)))

&lt;img src="img/sf-classes-02.png" width="60%" style="display: block; margin: auto;" /&gt;

---

* A **geometry collection** can contain any combination of geometries including (multi)points and linestrings
    * GEOMETRYCOLLECTION (MULTIPOINT (5 2, 1 3, 3 4, 3 2), LINESTRING (1 5, 4 4, 4 1, 2 2, 3 2))

&lt;img src="img/sf-geomcollection.png" width="40%" style="display: block; margin: auto;" /&gt;


---

* Simple feature objects in R are stored in a data frame
* Geographic data occupying a special column, usually named `geom` or `geometry`. 

&lt;img src="img/sf-examples.png" width="60%" style="display: block; margin: auto;" /&gt;

Three classes of sf objects
* **sfg** : geometry
* **sfc** : column - set of geometry plus coordinates system
* **sf** : information about each geometry

---

## sf geometry (sfg) class



```r
library(sf)
```

```
Linking to GEOS 3.6.1, GDAL 2.2.3, PROJ 4.9.3
```

--
* Creating a point from a vector

```r
sf::st_point(c(5, 2))
```

```
POINT (5 2)
```

--
* For line, we need to create a **matrix** with rbind

```r
multipoint_matrix = rbind(c(5, 2), c(1, 3), c(3, 4), c(3, 2))
st_multipoint(multipoint_matrix)
```

```
MULTIPOINT (5 2, 1 3, 3 4, 3 2)
```

---

## sf geometry (sfg) class

* For multiline, we need to create a **list of matrices**

```r
multilinestring_list = list(rbind(c(1, 5), c(4, 4), c(4, 1), c(2, 2), c(3, 2)), 
                            rbind(c(1, 2), c(2, 4)))
st_multilinestring((multilinestring_list))
```

```
MULTILINESTRING ((1 5, 4 4, 4 1, 2 2, 3 2), (1 2, 2 4))
```

--
* Idem for geometry collection

```r
geometrycollection_list = list(sf::st_multipoint(multipoint_matrix),
                              sf::st_multilinestring(multilinestring_list))
st_geometrycollection(geometrycollection_list)
```

```
GEOMETRYCOLLECTION (MULTIPOINT (5 2, 1 3, 3 4, 3 2), MULTILINESTRING ((1 5, 4 4, 4 1, 2 2, 3 2), (1 2, 2 4)))
```

---

## sf column (sfc) class

List of sfg obkects that also contains also information about the coordinate system


```r
point1 = st_point(c(5, 2))
point2 = st_point(c(1, 3))
points_sfc = st_sfc(point1, point2)
points_sfc
```

```
Geometry set for 2 features 
geometry type:  POINT
dimension:      XY
bbox:           xmin: 1 ymin: 2 xmax: 5 ymax: 3
epsg (SRID):    NA
proj4string:    NA
```

```
POINT (5 2)
```

```
POINT (1 3)
```

---

## sf column (sfc) class

Now add Coordinate Reference System (crs)


```r
st_sfc(point1, point2, crs = 4326)
```

```
Geometry set for 2 features 
geometry type:  POINT
dimension:      XY
bbox:           xmin: 1 ymin: 2 xmax: 5 ymax: 3
epsg (SRID):    4326
proj4string:    +proj=longlat +datum=WGS84 +no_defs
```

```
POINT (5 2)
```

```
POINT (1 3)
```

---

## sf class

Add some information about the geometry.


```r
lnd_point = st_point(c(0.1, 51.5))                 # sfg object
lnd_geom = st_sfc(lnd_point, crs = 4326)           # sfc object
lnd_attrib = data.frame(                           # data.frame object
  name = "London",
  temperature = 25,
  date = as.Date("2017-06-21")
  )
st_sf(lnd_attrib, geometry = lnd_geom)
```

```
Simple feature collection with 1 feature and 3 fields
geometry type:  POINT
dimension:      XY
bbox:           xmin: 0.1 ymin: 51.5 xmax: 0.1 ymax: 51.5
epsg (SRID):    4326
proj4string:    +proj=longlat +datum=WGS84 +no_defs
    name temperature       date         geometry
1 London          25 2017-06-21 POINT (0.1 51.5)
```

---
layout: true

# Static maps

---

## Load necessary libraries



```r
library("readxl") # Import the data from Excel file
library("dplyr")  # filter and reformat data frames

library("ggplot2") # graphics
library("sf") # simple features
library("rnaturalearth") 
library("rnaturalearthdata")
```

---

## Read the world map data

* `scale` can be 'small', 'medium', 'large'
* `returnclass` can be 'sp' or 'sf' - sf (simple features) is an evolution of sp



```r
world &lt;- rnaturalearth::ne_countries(scale = "medium", returnclass = "sf")
```

---

The world data are returned as a sf (simple feature) dataframe which contains
* normal fields
* one field called geometry which contains points, lines or polygon coordinate information


```r
colnames(world)
```

```
 [1] "scalerank"  "featurecla" "labelrank"  "sovereignt" "sov_a3"    
 [6] "adm0_dif"   "level"      "type"       "admin"      "adm0_a3"   
[11] "geou_dif"   "geounit"    "gu_a3"      "su_dif"     "subunit"   
[16] "su_a3"      "brk_diff"   "name"       "name_long"  "brk_a3"    
[21] "brk_name"   "brk_group"  "abbrev"     "postal"     "formal_en" 
[26] "formal_fr"  "note_adm0"  "note_brk"   "name_sort"  "name_alt"  
[31] "mapcolor7"  "mapcolor8"  "mapcolor9"  "mapcolor13" "pop_est"   
[36] "gdp_md_est" "pop_year"   "lastcensus" "gdp_year"   "economy"   
[41] "income_grp" "wikipedia"  "fips_10"    "iso_a2"     "iso_a3"    
[46] "iso_n3"     "un_a3"      "wb_a2"      "wb_a3"      "woe_id"    
[51] "adm0_a3_is" "adm0_a3_us" "adm0_a3_un" "adm0_a3_wb" "continent" 
[56] "region_un"  "subregion"  "region_wb"  "name_len"   "long_len"  
[61] "abbrev_len" "tiny"       "homepart"   "geometry"  
```

---

* The field `name` contains the name of the countries, `continent` the continent, etc...
* The field `geometry` contains the country outline
&lt;table class="table table-striped table-hover table-condensed" style="font-size: 9px; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; name &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; continent &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; geometry &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Aruba &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; North America &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; list(list(c(-69.89912109375, -69.895703125, -69.9421875, -70.004150390625, -70.06611328125, -70.05087890625, -70.035107421875, -69.97314453125, -69.91181640625, -69.89912109375, 12.452001953125, 12.422998046875, 12.438525390625, 12.50048828125, 12.54697265625, 12.5970703125, 12.614111328125, 12.567626953125, 12.48046875, 12.452001953125))) &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
--



```r
world$geometry[1]
```

```
Geometry set for 1 feature 
geometry type:  MULTIPOLYGON
dimension:      XY
bbox:           xmin: -70.06611 ymin: 12.423 xmax: -69.8957 ymax: 12.61411
epsg (SRID):    4326
proj4string:    +proj=longlat +datum=WGS84 +no_defs
```

---

## A simple world map

.left-code[
* Use `geom_sf`

```r
# Set the black and white theme
theme_set(theme_bw())

ggplot(data = world) +
    geom_sf() 
```
]

.right-plot[
&lt;img src="R-session-05-mapping_files/figure-html/unnamed-chunk-24-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---

## A simple world map

.left-code[
* Use `coord_sf(expand = FALSE)`to have the axis labels 

```r
ggplot(data = world) +
    geom_sf() +
    coord_sf(expand = FALSE)
```
]

.right-plot[
&lt;img src="R-session-05-mapping_files/figure-html/unnamed-chunk-25-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---

## Color continents

.left-code[
* Add `color="white", fill="blue"`

```r
ggplot(data = world) +
    geom_sf(color="white", fill="blue")+
    coord_sf(expand = FALSE) 
```
]

.right-plot[
&lt;img src="R-session-05-mapping_files/figure-html/unnamed-chunk-26-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---
## Plot population

.left-code[
* Use value of column `pop_est`

```r
ggplot(data = world) +
    geom_sf(aes(fill= pop_est))+
    coord_sf(expand = FALSE)
```
]

.right-plot[
&lt;img src="R-session-05-mapping_files/figure-html/unnamed-chunk-27-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---
## Plot population

.left-code[
* Change color scale
* Transform the data

```r
ggplot(data = world) +
    geom_sf(aes(fill= pop_est)) +
    coord_sf(expand = FALSE) +
    scale_fill_viridis_c(trans = "log10")
```
]

.right-plot[
&lt;img src="R-session-05-mapping_files/figure-html/unnamed-chunk-28-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---
## Modify projections
.left-code[
* Specify coordinate system: https://geocompr.robinlovelace.net/spatial-class.html#crs-intro

    * Lambert projection
    * From the North Pole
    * "+proj=laea +lat_0=90 +lon_0=0 "

```r
ggplot(data = world) +
    geom_sf() +
    coord_sf(expand = FALSE,
             crs = "+proj=laea +lat_0=90 +lon_0=0 ")
```
]

.right-plot[
&lt;img src="R-session-05-mapping_files/figure-html/unnamed-chunk-29-1.png" width="70%" style="display: block; margin: auto;" /&gt;
]

---
## Zoom
.left-code[
* Centered on Singapore

```r
ggplot(data = world) +
    geom_sf() +
    coord_sf(xlim=c(90,110), 
             ylim=c(-10,10))
```
.warning[Resolution is not optimal]
]

.right-plot[
&lt;img src="R-session-05-mapping_files/figure-html/unnamed-chunk-30-1.png" width="70%" style="display: block; margin: auto;" /&gt;
]

---
## Add country names

* Must first define coordinates centroid of each country (X and Y)


```r
world_centroids&lt;- st_coordinates(st_centroid(world$geometry))
```
--
* Bind the 2 tables

```r
world_centroids &lt;- cbind(world, world_centroids)
```

&lt;table class="table table-striped table-hover table-condensed" style="font-size: 9px; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; name &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; X &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Y &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; geometry &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Aruba &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -69.98268 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 12.52088 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; list(list(c(-69.89912109375, -69.895703125, -69.9421875, -70.004150390625, -70.06611328125, -70.05087890625, -70.035107421875, -69.97314453125, -69.91181640625, -69.89912109375, 12.452001953125, 12.422998046875, 12.438525390625, 12.50048828125, 12.54697265625, 12.5970703125, 12.614111328125, 12.567626953125, 12.48046875, 12.452001953125))) &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
## Add country names

.left-code[
* Use `geom_text()`


```r
ggplot(data = world_centroids) +
    geom_sf() +
    coord_sf(xlim=c(70,130), 
             ylim=c(-20,20)) +
    geom_text(aes(x = X, y=Y, label=name), 
              size=5) +
    xlab("Longitude") +
    ylab("Latitude")
```
]

.right-plot[
&lt;img src="R-session-05-mapping_files/figure-html/unnamed-chunk-34-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]


---
layout: true

# Plot data

---

## Read the data


```r
bolido &lt;- readxl::read_excel("data/bolido.xlsx")
```


&lt;table class="table table-striped table-hover table-condensed" style="font-size: 9px; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; cruise &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; station_id &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; date &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; depth_level &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; depth &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; latitude &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; longitude &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; oceanic_region &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; temperature &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; salinity &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; reads_total &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; bolido_reads &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; bolido_pct &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; species_dominant &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; MALINA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 430 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2009-08-18 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; surface &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 71.1300 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -136.420 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Beaufort Sea &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.804 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25.935 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10495 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0381134 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Parmales_env_3B_sp. &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; MALINA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 460 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2009-08-19 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; surface &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70.4000 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -136.030 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Beaufort Sea &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.076 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25.384 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9591 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0417058 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Parmales_env_3B_sp. &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; MALINA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 540 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2009-08-17 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; surface &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70.4500 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -137.530 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Beaufort Sea &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.610 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 26.246 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9900 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1414141 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Parmales_env_3B_sp. &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; MALINA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 620 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2009-08-11 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; surface &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70.6800 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -139.627 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Beaufort Sea &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.231 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 22.522 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7557 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1455604 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Parmales_env_3B_sp. &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; MALINA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 670 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2009-08-10 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; surface &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 69.7980 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -138.441 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Beaufort Sea &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.740 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 23.560 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8348 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 22 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.2635362 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Parmales_env_3B_sp. &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; MALINA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 760 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2009-08-12 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; surface &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70.3300 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -140.470 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Beaufort Sea &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.511 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 22.455 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8319 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0721241 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Parmales_env_3A_sp. &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; CASES &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; CA15 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2003-10-01 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; surface &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 29 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 71.5367 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -126.955 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Arctic Ocean &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.780 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 30.620 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 12354 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 211 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.7079488 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Parmales_env_1_X_sp. &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; CASES &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 200 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2003-11-01 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; surface &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 35 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 69.9290 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -126.489 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Arctic Ocean &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -1.460 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 31.500 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 12797 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 544 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4.2509963 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Parmales_env_1_X_sp. &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; ArcticNet &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; CA18 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2005-09-01 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; surface &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 32 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70.6663 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -122.993 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Arctic Ocean &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -1.040 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 32.040 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9531 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.4511594 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Triparma_laevis_clade &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; CFL &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 405 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2007-11-01 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; surface &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70.6217 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -123.001 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Arctic Ocean &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -1.650 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 30.130 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 13471 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 20 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1484671 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Parmales_env_1_X_sp. &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

## A bit of biology... Bolidophyceae and Parmales

.pull-left[
### _Triparma_
&lt;img src="img/2011-Ichinomya-Triparma.png" width="70%" style="display: block; margin: auto;" /&gt;
* Covered with silica
]

.pull-right[
### _Bolidomonas_
&lt;img src="img/1999-Guillou-Bolidomonas_drawing.png" width="50%" style="display: block; margin: auto;" /&gt;
* 1.5 µm
]



.footnote[_Guillou, L., Chrétiennot-Dinet, M.-J., Medlin, L.K., Claustre, H., Loiseaux-de Goër, S. &amp; Vaulot, D. 1999. J. Phycol. 35:368–81.  
Ichinomiya, M., Yoshikawa, S., Kamiya, M., Ohki, K., Takaichi, S. &amp; Kuwata, A. 2011. J. Phycol. 47:144–51.  
Ichinomiya, M., dos Santos, A.L., Gourvil, P., Yoshikawa, S., Kamiya, M., Ohki, K., Audic, S. et al. 2016. ISME J. 10:2419–34._
]

---

## Plot the stations where Bolidophyceae found

.left-code[
* Filter by to remove stations where Bolido are not present

```r
ggplot(data = world) +
    geom_sf()+
    coord_sf(expand = FALSE) +
    geom_point(data=filter(bolido, 
                           bolido_pct &gt;0), 
               aes(x=longitude, 
                   y=latitude), 
               size=3)
```
]

.right-plot[
&lt;img src="R-session-05-mapping_files/figure-html/unnamed-chunk-39-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]

---

## Percentage of Bolidophyceae

.left-code[
* Filter by to remove stations where Bolido are not present

```r
ggplot(data = world) +
    geom_sf()+
    coord_sf(expand = FALSE) +
    geom_point(data=filter(bolido, 
                           bolido_pct &gt;0), 
               aes(x=longitude, 
                   y=latitude, 
                   size=bolido_pct),
               color="blue")
```
]

.right-plot[
&lt;img src="R-session-05-mapping_files/figure-html/unnamed-chunk-40-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]

---

## Dominant species of _Triparma_

.left-code[
* Color with species
* Put species legend at bottom on 2 rows


```r
ggplot(data = world) +
    geom_sf()+
    coord_sf(expand = FALSE) +
    geom_point(data=filter(bolido, 
                           bolido_pct &gt;0,
                           stringr::str_detect(species_dominant, "Triparma")), 
               aes(x=longitude, 
                   y=latitude,
                   color=species_dominant),
               size = 4) +
   scale_colour_viridis_d() +
   theme(legend.position="bottom") +
   guides(color=guide_legend(nrow=2,
                             byrow=TRUE))
```

]

.right-plot[
&lt;img src="R-session-05-mapping_files/figure-html/unnamed-chunk-41-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]

---

layout: true

# Interactive maps

---

## Leaflet

.pull-left[
* Javascript: https://leafletjs.com/
* Leaflet for R : https://rstudio.github.io/leaflet/
* All functions from `leaflet` package


```r
library("leaflet") 
```
]

.pull-right[
&lt;img src="img/leaflet.png" width="80%" style="display: block; margin: auto;" /&gt;
]




---

## Create an empty map

.left-code[


```r
leaflet(width = 750, height = 500)
```

]

.right-plot[
<div id="htmlwidget-4f6ab0ad45600f29161a" style="width:750px;height:500px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-4f6ab0ad45600f29161a">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}}},"evals":[],"jsHooks":[]}</script>
]

---

## Add background (tiles)


.left-code[
 

```r
leaflet(width = 750, height = 500)%&gt;%
  addTiles()
```

]

.right-plot[
<div id="htmlwidget-85e431920cbf78e2ad82" style="width:750px;height:500px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-85e431920cbf78e2ad82">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]}]},"evals":[],"jsHooks":[]}</script>
]

---

## Set limits and zoom


.left-code[


```r
leaflet(width = 750, height = 500)%&gt;%
  addTiles() %&gt;%
  setView(lng=0, lat=0, zoom=2)
```

]

.right-plot[
<div id="htmlwidget-abcdb5a1685c65de358d" style="width:750px;height:500px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-abcdb5a1685c65de358d">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]}],"setView":[[0,0],2,[]]},"evals":[],"jsHooks":[]}</script>
]

---

## Adding data points


.left-code[
 

```r
leaflet(width = 750, height = 500)%&gt;%
  addTiles() %&gt;%
  setView(lng=0, lat=0, zoom=2) %&gt;% 
  addCircleMarkers(data = bolido, 
                   lat = ~ latitude, 
                   lng = ~ longitude,
               radius = 5,
         label = ~ station_id,
         labelOptions = labelOptions(textsize = "10px", 
                                     noHide = T),
         clusterOptions = markerClusterOptions())
```

]

.right-plot[
<div id="htmlwidget-7060116bbeed8740f3e7" style="width:750px;height:500px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-7060116bbeed8740f3e7">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addCircleMarkers","args":[[71.13,70.4,70.45,70.68,69.798,70.33,71.5367,69.929,70.6663,70.6217,71.3297,70.6645,-62.2038,-62.2042,-62.2066,-62.211,-62.2164,-62.2113,-62.2161,-62.2204,-62.2239,-62.228,78.8292,78.8288,78.7538,78.8327,78.824,78.6102,79.0643,79.7397,81.4935,83.9227,83.5882,82.1657,77.3968,81.8758,85.159,87.9245,50.151,41.8398,35.35,32.7418,32.646,32.7747,69.0233,65.9449,39.1404,38.7573,38.6769,40.1451,40.6599,38.6667,34.41,39.1343,39.4151,37.167,51.7423,29.4667,32.822,34.3244,55.0331,66.0069,66.0078,65.4886,65.8172,43.1758,66.1316,42.2449,32.0694,-33.8971,42.49,60.1612,31.3836,31.9828,21.2688,51.3614,78.4533,8.5216,53.5809,-34.37,-34.6759,-34.42,44.6936,36.9977,44.6667,59.8162,59.8996,59.622,37.4328,48.359,43.6861,56.9631,58.957,60.1433,57.8498,43.4325,65.7064,38.4133,51.7961,51.4347,51.2695,51.3073,51.3749,51.441,51.4716,51.3348,51.2777,51.1857,51.5803,35.3637,51.4584,51.7483,51.6829,51.4816,38.8855,-64.774,35,48.7778,64.2083,45.08,43.2264,35.1927,35.0864,35.82,16.8026,27.4694,54.1819,59.8822,31.216,38.6792,39.3322,26.1029,24.7449,32.7524,40.808,48.0405,38.2686,32.867,27.6158,30.2484,45.502,45.4125,45.3256,43.3333,9.3485,33.9126,33.907,43.8444,43.8604,21.2888,21.2866,34.7181,35.661,41.6666,33.3231,41.5245,53.2254,45.3144,46.4416,-36.2928,45.4568,-17.2894,45.4142,-45.7442,54.8333,41.6835,41.1416,43.9475,43.8514,43.57,32.16,74.31,37.0051,38.4843,-50.05,-52.93,-60.82,-66.39,-69.09,-69.38,78.8403,78.832,78.8348,78.8332,78.8333],[-136.42,-136.03,-137.53,-139.627,-138.441,-140.47,-126.955,-126.489,-122.993,-123.001,-133.766,-122.998,-58.9361,-58.9267,-58.9178,-58.907,-58.9017,-58.9537,-58.9498,-58.948,-58.9427,-58.9325,7.0223,4.0085,-12.7862,-4.5963,-3.939,5.068,3.3328,4.5053,30.1722,60.6552,87.4518,126.97,118.196,130.878,123.359,61.125,-4.13,-83.1899,25.29,-16.7113,-16.9102,-16.8287,-105.343,-22.4192,-9.38011,-8.96633,-9.01239,-8.86933,-8.70376,-9.4367,-9.51,-9.38478,-9.21883,-7.504,-8.3112,34.9291,32.954,135.121,-1.43278,-18.1965,-18.1953,-18.0608,-18.1018,27.9086,-18.7902,27.4008,34.843,18.3868,3.15,5.11504,-80.8667,-81.0167,-157.722,3.11886,-2.82967,81.0521,8.14864,-54.16,-54.2752,-54.16,-63.6403,-7.97312,-1.16666,10.5986,10.72,10.6282,-25.19,-4.552,7.31567,-2.1031,-2.9726,-1.2825,-5.6495,2.89966,-18.1181,27.0342,1.01296,2.81087,2.9047,2.84933,3.21833,3.13995,3.05917,2.50215,2.6135,2.70167,2.7897,33.2896,2.35047,2.698,2.4152,2.45148,-76.5416,-64.0529,33,-3.9375,-22.015,13.61,5.74583,-2.88005,-2.21466,-5.75,-88.0816,-80.2834,7.9,23.2538,29.966,-76.1742,-75.4699,-80.0931,-80.7838,-79.8995,14.25,-123.026,15.6371,-117.257,-82.7259,-88.7483,12.4176,12.5265,13.3319,-1.925,-82.266,27.0253,27.0415,-69.6409,-69.5781,-156.864,-157.844,-76.6707,24.99,2.8,-79.1676,-70.6722,-4.15903,12.5083,30.7759,174.819,12.2605,-149.54,12.4378,170.771,10,-8.8341,-8.6668,12.935,13.0731,13.595,-64.5,-20.3043,-7.97312,21.3169,-178.41,-178.41,-170.93,-166.01,-164.88,-164.86,-11.9727,-8.006,-4.93217,-3.89483,-0.508333],5,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},{"showCoverageOnHover":true,"zoomToBoundsOnClick":true,"spiderfyOnMaxZoom":true,"removeOutsideVisibleBounds":true,"spiderLegPolylineOptions":{"weight":1.5,"color":"#222","opacity":0.5},"freezeAtZoom":false},null,null,null,["430","460","540","620","670","760","CA15","200","CA18","405","BFB5","405","A1","A2","A3","A4","A5","G1","G2","G3","G4","G5","27","53","114","130","132","176","183","185","209","235","250","287","311","329","341","357","1","10","100","101","102","103","105","106","107","108","109","110","111","113","114","115","116","117","118","122","123","124","125","126","127","128","129","13","130","131","132","133","14","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","15","162","163","164","165","166","167","168","169","17","170","171","172","173","174","175","176","177","178","18","182","183","184","185","186","187","19","2","20","21","22","24","25","26","28","29","3","30","34","35","36","37","38","39","4","41","42","43","45","46","47","48","49","50","51","52","53","54","55","56","57","58","5","6","60","61","62","63","64","65","69","7","70","71","72","73","74","76","77","78","8","80","81","90","6","8","16","22","25","26","T1","T5","T6","T7","T9"],{"interactive":false,"permanent":true,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"setView":[[0,0],2,[]],"limits":{"lat":[-69.38,87.9245],"lng":[-178.41,174.819]}},"evals":[],"jsHooks":[]}</script>
]


---

## Adding background


.left-code[


```r
leaflet(width = 750, height = 500)%&gt;%
  addTiles() %&gt;%
  setView(lng=0, lat=0, zoom=2) %&gt;% 
  addCircleMarkers(data = bolido, 
                   lat = ~ latitude, 
                   lng = ~ longitude,
               radius = 5,
         label = ~ station_id,
         labelOptions = labelOptions(textsize = "10px", noHide = T),
         clusterOptions = markerClusterOptions()) %&gt;% 
  addProviderTiles(providers$Esri.OceanBasemap)
```
* https://leaflet-extras.github.io/leaflet-providers/preview/

]

.right-plot[
<div id="htmlwidget-27030f70d7f3a2ce24c4" style="width:750px;height:500px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-27030f70d7f3a2ce24c4">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addCircleMarkers","args":[[71.13,70.4,70.45,70.68,69.798,70.33,71.5367,69.929,70.6663,70.6217,71.3297,70.6645,-62.2038,-62.2042,-62.2066,-62.211,-62.2164,-62.2113,-62.2161,-62.2204,-62.2239,-62.228,78.8292,78.8288,78.7538,78.8327,78.824,78.6102,79.0643,79.7397,81.4935,83.9227,83.5882,82.1657,77.3968,81.8758,85.159,87.9245,50.151,41.8398,35.35,32.7418,32.646,32.7747,69.0233,65.9449,39.1404,38.7573,38.6769,40.1451,40.6599,38.6667,34.41,39.1343,39.4151,37.167,51.7423,29.4667,32.822,34.3244,55.0331,66.0069,66.0078,65.4886,65.8172,43.1758,66.1316,42.2449,32.0694,-33.8971,42.49,60.1612,31.3836,31.9828,21.2688,51.3614,78.4533,8.5216,53.5809,-34.37,-34.6759,-34.42,44.6936,36.9977,44.6667,59.8162,59.8996,59.622,37.4328,48.359,43.6861,56.9631,58.957,60.1433,57.8498,43.4325,65.7064,38.4133,51.7961,51.4347,51.2695,51.3073,51.3749,51.441,51.4716,51.3348,51.2777,51.1857,51.5803,35.3637,51.4584,51.7483,51.6829,51.4816,38.8855,-64.774,35,48.7778,64.2083,45.08,43.2264,35.1927,35.0864,35.82,16.8026,27.4694,54.1819,59.8822,31.216,38.6792,39.3322,26.1029,24.7449,32.7524,40.808,48.0405,38.2686,32.867,27.6158,30.2484,45.502,45.4125,45.3256,43.3333,9.3485,33.9126,33.907,43.8444,43.8604,21.2888,21.2866,34.7181,35.661,41.6666,33.3231,41.5245,53.2254,45.3144,46.4416,-36.2928,45.4568,-17.2894,45.4142,-45.7442,54.8333,41.6835,41.1416,43.9475,43.8514,43.57,32.16,74.31,37.0051,38.4843,-50.05,-52.93,-60.82,-66.39,-69.09,-69.38,78.8403,78.832,78.8348,78.8332,78.8333],[-136.42,-136.03,-137.53,-139.627,-138.441,-140.47,-126.955,-126.489,-122.993,-123.001,-133.766,-122.998,-58.9361,-58.9267,-58.9178,-58.907,-58.9017,-58.9537,-58.9498,-58.948,-58.9427,-58.9325,7.0223,4.0085,-12.7862,-4.5963,-3.939,5.068,3.3328,4.5053,30.1722,60.6552,87.4518,126.97,118.196,130.878,123.359,61.125,-4.13,-83.1899,25.29,-16.7113,-16.9102,-16.8287,-105.343,-22.4192,-9.38011,-8.96633,-9.01239,-8.86933,-8.70376,-9.4367,-9.51,-9.38478,-9.21883,-7.504,-8.3112,34.9291,32.954,135.121,-1.43278,-18.1965,-18.1953,-18.0608,-18.1018,27.9086,-18.7902,27.4008,34.843,18.3868,3.15,5.11504,-80.8667,-81.0167,-157.722,3.11886,-2.82967,81.0521,8.14864,-54.16,-54.2752,-54.16,-63.6403,-7.97312,-1.16666,10.5986,10.72,10.6282,-25.19,-4.552,7.31567,-2.1031,-2.9726,-1.2825,-5.6495,2.89966,-18.1181,27.0342,1.01296,2.81087,2.9047,2.84933,3.21833,3.13995,3.05917,2.50215,2.6135,2.70167,2.7897,33.2896,2.35047,2.698,2.4152,2.45148,-76.5416,-64.0529,33,-3.9375,-22.015,13.61,5.74583,-2.88005,-2.21466,-5.75,-88.0816,-80.2834,7.9,23.2538,29.966,-76.1742,-75.4699,-80.0931,-80.7838,-79.8995,14.25,-123.026,15.6371,-117.257,-82.7259,-88.7483,12.4176,12.5265,13.3319,-1.925,-82.266,27.0253,27.0415,-69.6409,-69.5781,-156.864,-157.844,-76.6707,24.99,2.8,-79.1676,-70.6722,-4.15903,12.5083,30.7759,174.819,12.2605,-149.54,12.4378,170.771,10,-8.8341,-8.6668,12.935,13.0731,13.595,-64.5,-20.3043,-7.97312,21.3169,-178.41,-178.41,-170.93,-166.01,-164.88,-164.86,-11.9727,-8.006,-4.93217,-3.89483,-0.508333],5,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},{"showCoverageOnHover":true,"zoomToBoundsOnClick":true,"spiderfyOnMaxZoom":true,"removeOutsideVisibleBounds":true,"spiderLegPolylineOptions":{"weight":1.5,"color":"#222","opacity":0.5},"freezeAtZoom":false},null,null,null,["430","460","540","620","670","760","CA15","200","CA18","405","BFB5","405","A1","A2","A3","A4","A5","G1","G2","G3","G4","G5","27","53","114","130","132","176","183","185","209","235","250","287","311","329","341","357","1","10","100","101","102","103","105","106","107","108","109","110","111","113","114","115","116","117","118","122","123","124","125","126","127","128","129","13","130","131","132","133","14","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","15","162","163","164","165","166","167","168","169","17","170","171","172","173","174","175","176","177","178","18","182","183","184","185","186","187","19","2","20","21","22","24","25","26","28","29","3","30","34","35","36","37","38","39","4","41","42","43","45","46","47","48","49","50","51","52","53","54","55","56","57","58","5","6","60","61","62","63","64","65","69","7","70","71","72","73","74","76","77","78","8","80","81","90","6","8","16","22","25","26","T1","T5","T6","T7","T9"],{"interactive":false,"permanent":true,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addProviderTiles","args":["Esri.OceanBasemap",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]}],"setView":[[0,0],2,[]],"limits":{"lat":[-69.38,87.9245],"lng":[-178.41,174.819]}},"evals":[],"jsHooks":[]}</script>
]

---

layout: true

# Other packages

---
## Thematic maps (tmap)

* https://cran.r-project.org/web/packages/tmap/vignettes/tmap-getstarted.html

&lt;img src="img/thematic_maps_01.png" width="60%" style="display: block; margin: auto;" /&gt;

---

## Raster

* https://cran.r-project.org/web/packages/raster/vignettes/Raster.pdf


&lt;img src="img/raster_sst.png" width="60%" style="display: block; margin: auto;" /&gt;


---

layout: true
background-image: url(img/course-logo.png)
background-position: right top 30px 
background-size: 45%

# Next time: Your choice ?

---

.font150[

* Strings and date manipulation
* Text mining
* Web mining
* Create your own package
* Intro to databases

]

---
layout: true

# Your turn

---

.left-code[

* Use four shapes files
    * world
    * world_centroids
    * bathymetry 0 m 
    * bathymetry 200 m
    
* https://www.naturalearthdata.com/downloads/10m-physical-vectors/10m-bathymetry/
* Files can be read with  `sf::read_sf`

* Small trick: must use the Windows file convention (\ and not /) and then must escape it !!!


```r
bathy_0 &lt;- read_sf("data\\ne_10m_bathymetry_L_0.shp")
bathy_200 &lt;- read_sf("data\\ne_10m_bathymetry_K_200.shp")
```

]
.right-plot[

&lt;img src="R-session-05-mapping_files/figure-html/unnamed-chunk-52-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---


```r
# Very tricky must use the Windows file convention (backslash and not slash) !!!
bathy_0 &lt;- read_sf("data\\ne_10m_bathymetry_L_0.shp")
bathy_200 &lt;- read_sf("data\\ne_10m_bathymetry_K_200.shp")

theme_set(theme_bw())

ggplot() +
    geom_sf(data = world, fill="grey90", color="grey90") +
    geom_sf(data = bathy_0, fill="deepskyblue", color="deepskyblue") +
    geom_sf(data=bathy_200, fill="white", color="white")+
    coord_sf(xlim=c(-20,40), 
             ylim=c(30,70)) +
    geom_point(data=filter(bolido, 
                           bolido_pct &gt;0), 
               aes(x=longitude, 
                   y=latitude, 
                   size=bolido_pct),
               color="red")+
    geom_text(data = world_centroids, aes(x = X, y=Y, label=name), 
              size=3) +
    xlab("Longitude") + ylab("Latitude") + labs(size = "Bolido %")
```
    </textarea>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "tomorrow-night-blue",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
